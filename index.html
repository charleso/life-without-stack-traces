<!DOCTYPE html>
<html>
  <head>
    <title>Life Without Stack Traces</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <style type="text/css">
    /* latin-ext */
      @font-face {
        font-family: 'Yanone Kaffeesatz';
        font-style: normal;
        font-weight: 400;
        src: local('Yanone Kaffeesatz Regular'), local('YanoneKaffeesatz-Regular'), url(fonts/YDAoLskQQ5MOAgvHUQCcLaa0P60JZGaCMFbL3N9v4H0.woff2) format('woff2');
        unicode-range: U+0100-024F, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF;
      }
      /* latin */
      @font-face {
        font-family: 'Yanone Kaffeesatz';
        font-style: normal;
        font-weight: 400;
        src: local('Yanone Kaffeesatz Regular'), local('YanoneKaffeesatz-Regular'), url(fonts/YDAoLskQQ5MOAgvHUQCcLWjF_m7mVnhXExjNED3rUtY.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
      }

      /* latin */
      @font-face {
        font-family: 'Droid Serif';
        font-style: normal;
        font-weight: 400;
        src: local('Droid Serif'), local('DroidSerif'), url(fonts/0AKsP294HTD-nvJgucYTaIgp9Q8gbYrhqGlRav_IXfk.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
      }
      /* latin */
      @font-face {
        font-family: 'Droid Serif';
        font-style: normal;
        font-weight: 700;
        src: local('Droid Serif Bold'), local('DroidSerif-Bold'), url(fonts/QQt14e8dY39u-eYBZmppwf79_ZuUxCigM2DespTnFaw.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
      }
      /* latin */
      @font-face {
        font-family: 'Droid Serif';
        font-style: italic;
        font-weight: 400;
        src: local('Droid Serif Italic'), local('DroidSerif-Italic'), url(fonts/cj2hUnSRBhwmSPr9kS589weOulFbQKHxPa89BaxZzA0.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
      }
      @font-face {
        font-family: 'Ubuntu Mono';
        font-style: normal;
        font-weight: 700;
        src: local('Ubuntu Mono Bold'), local('UbuntuMono-Bold'), url(fonts/ceqTZGKHipo8pJj4molytv79_ZuUxCigM2DespTnFaw.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
      }
      @font-face {
        font-family: 'Ubuntu Mono';
        font-style: normal;
        font-weight: 400;
        src: local('Ubuntu Mono'), local('UbuntuMono-Regular'), url(fonts/ViZhet7Ak-LRXZMXzuAfkYgp9Q8gbYrhqGlRav_IXfk.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
      }

      body {
        font-family: Futura, 'Yanone Kaffeesatz';
      }
      li {
        font-size: 30px;
        padding-top: 20px;
      }
      .remark-code {
        font-size: 30px;
      }
      h1, h2, h3 {
        font-weight: normal;
      }
      .inverse {
        background: #4795c6;
        color: white;
      }
      .inverse h1, .inverse h2 {
        color: #f3f3f3;
      }
      .relative h1 {
        position: relative !important;
      }
      .question {
        background: #76b242;
        color: white;
      }
      .rule {
        background: #ee2a24;
        color: white;
      }
      .boom {
      }
      .error {
        color: #ee2a24;
        font-size: 30px;
      }
      .image {
        padding: 0px;
        color: white;
        background-color: black;

        position: relative;
      }
      .image img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        /*height: 100%;*/
        float: left;
      }
      .image h1, .image h2 {
        position: absolute;
        bottom: 0;
        text-align: center;
        left: 20px;
      }
      .image-white {
        color: black;
        background-color: white;
      }
      .image-last h1 {
        right: 0;
        bottom: 100px;
      }
      .remark-code, .remark-inline-code {
        font-family: 'Ubuntu Mono';
      }
      .remark-slide-content {
        padding: 10px 10px 10px 30px;
      }
      .hljs-default .hljs {
        background-color: transparent;
        padding: 0px !important;
      }
      .ambiata-full {
        background-image: url(images/ambiata_avatar.png);
      }
      .evolution {
        background-color: #DEDEDE;
      }
      .evolution h1 {
        color: black !important;
      }
      .top h1 {
        top: 0px;
      }
      .toc {
         color: #777;
         margin-top: 135px;
      }
      .toc-selected {
         color: #000;
      }
      /*
      .ambiata-full h2 {
        position: absolute;
        bottom: 0;
        right: 0;
      }
      */
      .ambiata {
        background-image: url(images/ambiata_avatar.png);
        background-position: top right;
        background-size: 100px;
        /*-webkit-filter: grayscale(40%);*/
      }
      .code-small .remark-code {
        font-size: 20px;
      }
      .remark-container {
        height: 100%;
        width: 100%;
      }
      .remark-slide-number {
        display: none;
      }
    </style>
  </head>
  <body>

    <textarea id="source">
name: image
layout: true
class: center, middle, image

---
name: image-white
layout: true
class: center, middle, image, image-white

---
name: image-last
layout: true
class: center, middle, image, image-last

---
name: ambiata
layout: true
class: ambiata

---
name: ambiata-full
layout: true
class: center, middle, ambiata-full

---
name: code-small
layout: true
class: code-small

---
name: question
layout: true
class: center, middle, question

---
name: rule
layout: true
class: center, middle, rule

---
name: boom
layout: true
class: boom

---
name: inverse
layout: true
class: center, middle, inverse

---

class: center, middle
template: image

# Life Without Stack Traces

---

layout: false
template: image

<img src="images/chopsticks.jpg" />

# Charles O'Farrell












---
layout: false

## In The Beginning...

There was the checked exception 


---

## Hate

- http://literatejava.com/exceptions/checked-exceptions-javas-biggest-mistake/
- http://googletesting.blogspot.ru/2009/09/checked-exceptions-i-love-you-but-you.html

---

## Bad APIs

```java
void bytesToString(byte[] bytes) {
  ByteArrayOutputStream out = new ByteArrayOutputStream();
  try {
     out.write(bytes);
     out.close()
    return out.toSring();
  } catch (IOException e) {
     // This can never happen!
     // Should I rethrow? Eat it? Print Error?
   }
}
```

---

## Tea Leaves

```
java.lang.NullPointerException
  at com.example.MyService.list()
  at com.example.MyController.list()
```
---

---

## In Reality

```
java.lang.NullPointerException
  at com.example.MyService.list()
  at net.sf.cglib.proxy.MethodProxy.invoke()
  at org.springframework.aop.framework.Cglib2AopProxy$CglibMethodInvocation.invokeJoinpoint()
  at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed()
  at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed()
  at com.blogspot.nurkiewicz.LoggingAspect.logging()
  at sun.reflect.NativeMethodAccessorImpl.invoke0()
  at sun.reflect.NativeMethodAccessorImpl.invoke()
  at sun.reflect.DelegatingMethodAccessorImpl.invoke()
  at java.lang.reflect.Method.invoke()
  at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs()
  at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod()
  at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke()
  at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed()
  at org.springframework.aop.interceptor.AbstractTraceInterceptor.invoke()
  at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed()
  at org.springframework.transaction.interceptor.TransactionInterceptor.invoke()
  at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed()
  at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke()
  at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed()
  at org.springframework.aop.framework.Cglib2AopProxy$DynamicAdvisedInterceptor.intercept()
  at com.example.MyController.list()
```
---

## Exceptions don't compose

- TODO BETTER EXAMPLE
- http://benjiweber.co.uk/blog/2014/03/22/checked-exceptions-and-streams/

```java
void duplicatesShortStrings(input: String)
  throws CheckedException

asList("foo", "bar", "baz", "booooo")
  .stream()
  .map(Example::duplicatesShortStrings)
  .collect(Collectors.toList());
```

---

template: question

## Partial Functions

---

## Just say no

```scala
def safeFunction(): String = {
  val v: Option[String] = ...

  // This should never happen...
  v.get
}
```

- BOOM!
- TODO Show what that looks like

---

template: inverse

# FP

---

```
def load(id: Int): Future[List[Foo]] =
  for {
    u &lt;- loadUser(id)
    b &lt;- loadFoo(u)
  } yield b
```

- TODO
  - What does the stacktrace look like?
  - Oh no!

---

## TODO

```
java.lang.NullPointerException
  at com.example.MyService.loadFoo()
  at org.scala.Future.flatMap()
  at org.scala.Future.flatMap()
  at org.scala.Future.flatMap()
  at org.scala.Future.flatMap()
```

---

## TODO TITLE

```scala
case class UserNotFound(id: Int) extends Exception
def load(id: Int): UserNotFound \/ User

case class FooNotFound(id: Int) extends Exception
def load2(id: Int): FooNotFound \/ List[Foo]
```

---

## Simple example

```scala
def foo: Exception \/ User
def bar: Exception \/ List[Foo]

def load(id: Int): Exception \/ List[Foo] =
  for {
    u &lt;- loadUser(id)
    b &lt;- loadFoo(u)
  } yield b
```

---

template: question

## This is _not_ a Monad tutorial


---

## What now?

```scala
load(id) match {
  case -\/(e) =>
    // What do we know about e?!?
    println("Something bad happend: " + e.toString)
}
```

---

## Types Are Good

```scala
case class UserNotFound(id: Int)
def load(id: Int): UserNotFound \/ User

case class FooNotFound(id: Int)
def load2(id: Int): FooNotFound \/ List[Foo]
```

---

## Hmmm

```scala
def load(id: Int): ??? \/ List[Foo] =
  for {
    u &lt;- loadUser(id)
    b &lt;- loadFoo(u)
  } yield b
```

---

## ADT

```scala
sealed trait LoadError
case class LoadErrorUser(e: UserNotFound) extends LoadError
case class LoadErrorFoo(e: FooNotFound) extends LoadError
```

---

## Hmmm

```scala
def load(id: Int): LoadError \/ List[Foo] =
  for {
    u &lt;- loadUser(id).leftMap(LoadErrorUser(_))
    b &lt;- loadFoo(u).leftMap(LoadErrorFoo(_))
  } yield b
```

---

## Catch

```scala
load(id) match {
  case -\/(e) =>
    e match {

      case LoadErrorUser(u) =>
        loadSomethingElse(e)

      case LoadErrorFoo(f)
         AnotherError(f).left
    }
}
```

---

## "Logical" stack trace

```
Something failed with "/bob/1"
  - Load failed with:
    - User not found: "bob"
```













---

## What now?

```scala
def foo: Future[Exception \/ User]
def bar: Future[Exception \/ List[Foo]]

def load(id: Int): Future[Exception \/ List[Foo]] =
  for {
    u &lt;- loadUser(id)
    b &lt;- u match {
      case -\/(e) =>
        Future.ok(-\/(e))
      case \/-(u2) =>
        loadFoo(u2)
    }
  } yield b
```

---

## EitherT

```
case class EitherT[F[_], L, R](run: F[L \/ R])



EitherT[Future, Exception, A] = Future[Exception \/ A]
```

---

## EitherT

```scala
def foo: EitherT[Future, Exception, User]
def bar: EitherT[Future, Exception, List[Foo]]

def load(id: Int): EitherT[Future, Exception List[Foo]] =
  for {
    u &lt;- loadUser(id)
    b &lt;- loadFoo(u2)
  } yield b

load(id).run
> res0: Future[Exception \/ List[Foo]]
```












NOTES:

Probably should use Task,
the problem/confusing thing with Future is it has Throwable

---

## Resources

- _Functional Programming in Scala_ by Paul Chiusano and Rúnar Bjarnason
  - Chapter 4: “Handling errors without exceptions”
- _Designing Fail Fast Error Handling_ by Noel Welsh
  - http://underscore.io/blog/posts/2015/02/23/designing-fail-fast-error-handling.html

    </textarea>
    <link rel="stylesheet" href="js/styles/idea.css">
    <script src="js/remark.js" type="text/javascript">
    </script>
    <script type="text/javascript">
      var slideshow = remark.create();
    </script>
  </body>
</html>.
